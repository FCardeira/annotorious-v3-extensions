(function(Z,ht){typeof exports=="object"&&typeof module<"u"?ht(exports):typeof define=="function"&&define.amd?define(["exports"],ht):(Z=typeof globalThis<"u"?globalThis:Z||self,ht(Z.OSDTextLayer={}))})(this,function(Z){"use strict";const ht=t=>{var e;return(e=t.bodies.find(n=>n.purpose==="transcribing"))==null?void 0:e.value};let wt;const je=new Uint8Array(16);function Ve(){if(!wt&&(wt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wt(je)}const L=[];for(let t=0;t<256;++t)L.push((t+256).toString(16).slice(1));function We(t,e=0){return L[t[e+0]]+L[t[e+1]]+L[t[e+2]]+L[t[e+3]]+"-"+L[t[e+4]]+L[t[e+5]]+"-"+L[t[e+6]]+L[t[e+7]]+"-"+L[t[e+8]]+L[t[e+9]]+"-"+L[t[e+10]]+L[t[e+11]]+L[t[e+12]]+L[t[e+13]]+L[t[e+14]]+L[t[e+15]]}const qe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),he={randomUUID:qe};function Ye(t,e,n){if(he.randomUUID&&!e&&!t)return he.randomUUID();t=t||{};const o=t.random||(t.rng||Ve)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=o[r];return e}return We(o)}var J=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(J||{});const Ct=(t,e)=>e,Me={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,a=0,l=Math.cos(a),c=Math.sin(a),p=e-o,d=n-r,m=l*p+c*d,u=c*p-l*d;return m*m/(s*s)+u*u/(i*i)<=1}};Ct(J.ELLIPSE,Me);const Qe={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const a=o[s][0],l=o[s][1],c=o[i][0],p=o[i][1];l>n!=p>n&&e<(c-a)*(n-l)/(p-l)+a&&(r=!r)}return r}};Ct(J.POLYGON,Qe);const Ze={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};Ct(J.RECTANGLE,Ze);const Je=[];for(let t=0;t<256;++t)Je.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ke=[];for(let t=0;t<256;++t)Ke.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),""))(),J.RECTANGLE,J.POLYGON,navigator.userAgent.indexOf("Mac OS X");const tn=t=>{const e=[];for(const n of t.querySelectorAll("String")){const o=n.getAttribute("ID")||Ye(),r=n.getAttribute("CONTENT"),s=parseFloat(n.getAttribute("HPOS")),i=parseFloat(n.getAttribute("VPOS")),a=parseFloat(n.getAttribute("WIDTH")),l=parseFloat(n.getAttribute("HEIGHT")),c=s+a,p=i+l;e.push({id:o,bodies:[{id:o,annotation:o,purpose:"transcribing",value:r}],target:{annotation:o,selector:{type:J.RECTANGLE,geometry:{bounds:{minX:s,minY:i,maxX:c,maxY:p},x:s,y:i,w:a,h:l}}}})}return e},en=t=>{const e=new DOMParser().parseFromString(t,"application/xml"),n=e.querySelector("Page"),o=[];for(const a of e.querySelectorAll("TextLine"))o.push(...tn(a));const r=n.getAttribute("ID"),s=parseFloat(n.getAttribute("HEIGHT")),i=parseFloat(n.getAttribute("WIDTH"));return{annotations:o,metadata:{id:r,height:s,width:i}}};function Y(){}function de(t){return t()}function pe(){return Object.create(null)}function dt(t){t.forEach(de)}function me(t){return typeof t=="function"}function Tt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function nn(t){return Object.keys(t).length===0}function M(t,e){t.appendChild(e)}function V(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode&&t.parentNode.removeChild(t)}function Bt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function K(t){return document.createElement(t)}function tt(t){return document.createTextNode(t)}function et(){return tt("")}function z(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function on(t){return Array.from(t.childNodes)}function jt(t,e){e=""+e,t.data!==e&&(t.data=e)}function C(t,e,n){t.classList[n?"add":"remove"](e)}let pt;function mt(t){pt=t}function rn(){if(!pt)throw new Error("Function called outside component initialization");return pt}function sn(t){rn().$$.on_mount.push(t)}const it=[],xt=[];let st=[];const ge=[],ln=Promise.resolve();let Vt=!1;function an(){Vt||(Vt=!0,ln.then(ye))}function Wt(t){st.push(t)}const qt=new Set;let lt=0;function ye(){if(lt!==0)return;const t=pt;do{try{for(;lt<it.length;){const e=it[lt];lt++,mt(e),cn(e.$$)}}catch(e){throw it.length=0,lt=0,e}for(mt(null),it.length=0,lt=0;xt.length;)xt.pop()();for(let e=0;e<st.length;e+=1){const n=st[e];qt.has(n)||(qt.add(n),n())}st.length=0}while(it.length);for(;ge.length;)ge.pop()();Vt=!1,qt.clear(),mt(t)}function cn(t){if(t.fragment!==null){t.update(),dt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Wt)}}function fn(t){const e=[],n=[];st.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),st=e}const Et=new Set;let nt;function gt(){nt={r:0,c:[],p:nt}}function yt(){nt.r||dt(nt.c),nt=nt.p}function S(t,e){t&&t.i&&(Et.delete(t),t.i(e))}function N(t,e,n,o){if(t&&t.o){if(Et.has(t))return;Et.add(t),nt.c.push(()=>{Et.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function Yt(t){t&&t.c()}function $t(t,e,n,o){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),o||Wt(()=>{const i=t.$$.on_mount.map(de).filter(me);t.$$.on_destroy?t.$$.on_destroy.push(...i):dt(i),t.$$.on_mount=[]}),s.forEach(Wt)}function Ot(t,e){const n=t.$$;n.fragment!==null&&(fn(n.after_update),dt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function un(t,e){t.$$.dirty[0]===-1&&(it.push(t),an(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function St(t,e,n,o,r,s,i,a=[-1]){const l=pt;mt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:Y,not_equal:r,bound:pe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:pe(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let p=!1;if(c.ctx=n?n(t,e.props||{},(d,m,...u)=>{const y=u.length?u[0]:m;return c.ctx&&r(c.ctx[d],c.ctx[d]=y)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](y),p&&un(t,d)),m}):[],c.update(),p=!0,dt(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){const d=on(e.target);c.fragment&&c.fragment.l(d),d.forEach(D)}else c.fragment&&c.fragment.c();e.intro&&S(t.$$.fragment),$t(t,e.target,e.anchor,e.customElement),ye()}mt(l)}class Pt{$destroy(){Ot(this,1),this.$destroy=Y}$on(e,n){if(!me(n))return Y;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!nn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function _e(t){let e,n,o,r,s;return{c(){e=K("div"),n=K("span"),o=tt(t[3]),r=tt(" "),z(e,"class","annotation"),z(e,"style",s=`left:${t[7]}px; top:${t[6]}px; width: ${t[2]}px; height: ${t[1]}px; transform: scale(${t[5]}, ${t[4]})`)},m(i,a){V(i,e,a),M(e,n),M(n,o),t[11](n),M(e,r)},p(i,a){a&8&&jt(o,i[3]),a&246&&s!==(s=`left:${i[7]}px; top:${i[6]}px; width: ${i[2]}px; height: ${i[1]}px; transform: scale(${i[5]}, ${i[4]})`)&&z(e,"style",s)},d(i){i&&D(e),t[11](null)}}}function hn(t){let e,n=t[3]&&_e(t);return{c(){n&&n.c(),e=et()},m(o,r){n&&n.m(o,r),V(o,e,r)},p(o,[r]){o[3]?n?n.p(o,r):(n=_e(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Y,o:Y,d(o){n&&n.d(o),o&&D(e)}}}function dn(t,e,n){let o,r,s,i,a,l,c,p,d,{annotation:m}=e,{opts:u}=e;function y(h){xt[h?"unshift":"push"](()=>{d=h,n(0,d)})}return t.$$set=h=>{"annotation"in h&&n(8,m=h.annotation),"opts"in h&&n(9,u=h.opts)},t.$$.update=()=>{t.$$.dirty&256&&n(10,o=m.target.selector.geometry.bounds),t.$$.dirty&1024&&n(7,r=o.minX),t.$$.dirty&1024&&n(6,s=o.minY),t.$$.dirty&1024&&n(2,i=o.maxX-o.minX),t.$$.dirty&1024&&n(1,a=o.maxY-o.minY),t.$$.dirty&5&&n(5,l=d?i/d.offsetWidth:1),t.$$.dirty&3&&n(4,c=d?a/d.offsetHeight:1),t.$$.dirty&768&&n(3,p=u.label(m))},[d,a,i,p,c,l,s,r,m,u,o,y]}class pn extends Pt{constructor(e){super(),St(this,e,dn,hn,Tt,{annotation:8,opts:9})}}function be(t){let e,n,o,r,s;return{c(){e=K("div"),n=K("span"),o=tt(t[1]),r=tt(" "),z(e,"class","annotation"),z(e,"style",s=t[3](t[2]))},m(i,a){V(i,e,a),M(e,n),M(n,o),t[6](n),M(e,r)},p(i,a){a&2&&jt(o,i[1]),a&4&&s!==(s=i[3](i[2]))&&z(e,"style",s)},d(i){i&&D(e),t[6](null)}}}function mn(t){let e,n=t[1]&&be(t);return{c(){n&&n.c(),e=et()},m(o,r){n&&n.m(o,r),V(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=be(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Y,o:Y,d(o){n&&n.d(o),o&&D(e)}}}function gn(t,e,n){let o,r,s,i,{annotation:a}=e,{opts:l}=e;const c=d=>{const m=l.offsetX||0,u=l.offsetY||0;if(l.position==="center"){const y=o.maxX-o.minX,h=o.minX+y/2-d[0]/2,T=o.maxY-o.minY,E=o.minY+T/2-d[1]/2;return`left:${h+m}px; top:${E+u}px;`}else return l.position==="topleft"?`left:${o.minX+m}px; top:${o.minY+u}px;`:`left:${o.minX+m}px; top:${o.maxY+u}px;`};function p(d){xt[d?"unshift":"push"](()=>{i=d,n(0,i)})}return t.$$set=d=>{"annotation"in d&&n(4,a=d.annotation),"opts"in d&&n(5,l=d.opts)},t.$$.update=()=>{t.$$.dirty&16&&(o=a.target.selector.geometry.bounds),t.$$.dirty&1&&n(2,r=i?[i.offsetWidth,i.offsetHeight]:[0,0]),t.$$.dirty&48&&n(1,s=l.label(a))},[i,s,r,c,a,l,p]}class yn extends Pt{constructor(e){super(),St(this,e,gn,mn,Tt,{annotation:4,opts:5})}}function we(t){let e,n,o,r,s;return{c(){e=K("div"),n=K("span"),o=tt(t[1]),r=tt(" "),z(e,"class","annotation"),z(e,"style",s=t[4](t[3],t[2],t[0]))},m(i,a){V(i,e,a),M(e,n),M(n,o),M(e,r)},p(i,a){a&2&&jt(o,i[1]),a&13&&s!==(s=i[4](i[3],i[2],i[0]))&&z(e,"style",s)},d(i){i&&D(e)}}}function _n(t){let e,n=t[1]&&we(t);return{c(){n&&n.c(),e=et()},m(o,r){n&&n.m(o,r),V(o,e,r)},p(o,[r]){o[1]?n?n.p(o,r):(n=we(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Y,o:Y,d(o){n&&n.d(o),o&&D(e)}}}function bn(t,e,n){let o,r,s,i,{annotation:a}=e,{opts:l}=e,{scale:c}=e,{imageSize:p}=e;const d=(m,u,y)=>{const h=(l.offsetX||0)/y,T=(l.offsetY||0)/y;if(l.position==="topleft"){const E=p[1]-u;return`left:${m+h}px; bottom:${E}px; transform: scale(${1/y})`}else return`left:${m+h}px; top:${u+T}px; transform: scale(${1/y})`};return t.$$set=m=>{"annotation"in m&&n(5,a=m.annotation),"opts"in m&&n(6,l=m.opts),"scale"in m&&n(0,c=m.scale),"imageSize"in m&&n(7,p=m.imageSize)},t.$$.update=()=>{t.$$.dirty&32&&n(8,o=a.target.selector.geometry.bounds),t.$$.dirty&256&&n(3,r=o.minX),t.$$.dirty&320&&n(2,s=l.position==="topleft"?o.minY:o.maxY),t.$$.dirty&96&&n(1,i=l.label(a))},[c,i,s,r,d,a,l,p,o]}class wn extends Pt{constructor(e){super(),St(this,e,bn,_n,Tt,{annotation:5,opts:6,scale:0,imageSize:7})}}function Mt(){}function Tn(t,e){for(const n in e)t[n]=e[n];return t}function Te(t){return t()}function xe(){return Object.create(null)}function ot(t){t.forEach(Te)}function I(t){return typeof t=="function"}function Qt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function xn(t){return Object.keys(t).length===0}function En(t,e,n,o){if(t){const r=Ee(t,e,n,o);return t[0](r)}}function Ee(t,e,n,o){return t[1]&&o?Tn(n.ctx.slice(),t[1](o(e))):n.ctx}function $n(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],i=Math.max(e.dirty.length,r.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|r[a];return s}return e.dirty|r}return e.dirty}function On(t,e,n,o,r,s){if(r){const i=Ee(e,n,o,s);t.p(i,r)}}function Sn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function O(t,e,n){t.insertBefore(e,n||null)}function $(t){t.parentNode&&t.parentNode.removeChild(t)}function Pn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function $e(t){return document.createTextNode(t)}function W(){return $e(" ")}function Ln(){return $e("")}function v(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function In(t){return Array.from(t.childNodes)}function vn(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,o,e),r}let _t;function bt(t){_t=t}function An(){if(!_t)throw new Error("Function called outside component initialization");return _t}function kn(){const t=An();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const s=vn(e,n,{cancelable:o});return r.slice().forEach(i=>{i.call(t,s)}),!s.defaultPrevented}return!0}}function at(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const ct=[],Oe=[];let ft=[];const Se=[],Hn=Promise.resolve();let Zt=!1;function Nn(){Zt||(Zt=!0,Hn.then(Pe))}function Jt(t){ft.push(t)}const Kt=new Set;let ut=0;function Pe(){if(ut!==0)return;const t=_t;do{try{for(;ut<ct.length;){const e=ct[ut];ut++,bt(e),Gn(e.$$)}}catch(e){throw ct.length=0,ut=0,e}for(bt(null),ct.length=0,ut=0;Oe.length;)Oe.pop()();for(let e=0;e<ft.length;e+=1){const n=ft[e];Kt.has(n)||(Kt.add(n),n())}ft.length=0}while(ct.length);for(;Se.length;)Se.pop()();Zt=!1,Kt.clear(),bt(t)}function Gn(t){if(t.fragment!==null){t.update(),ot(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Jt)}}function Rn(t){const e=[],n=[];ft.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),ft=e}const Lt=new Set;let Xn;function It(t,e){t&&t.i&&(Lt.delete(t),t.i(e))}function te(t,e,n,o){if(t&&t.o){if(Lt.has(t))return;Lt.add(t),Xn.c.push(()=>{Lt.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function Le(t){t&&t.c()}function ee(t,e,n,o){const{fragment:r,after_update:s}=t.$$;r&&r.m(e,n),o||Jt(()=>{const i=t.$$.on_mount.map(Te).filter(I);t.$$.on_destroy?t.$$.on_destroy.push(...i):ot(i),t.$$.on_mount=[]}),s.forEach(Jt)}function ne(t,e){const n=t.$$;n.fragment!==null&&(Rn(n.after_update),ot(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Fn(t,e){t.$$.dirty[0]===-1&&(ct.push(t),Nn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function oe(t,e,n,o,r,s,i,a=[-1]){const l=_t;bt(t);const c=t.$$={fragment:null,ctx:[],props:s,update:Mt,not_equal:r,bound:xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:xe(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let p=!1;if(c.ctx=n?n(t,e.props||{},(d,m,...u)=>{const y=u.length?u[0]:m;return c.ctx&&r(c.ctx[d],c.ctx[d]=y)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](y),p&&Fn(t,d)),m}):[],c.update(),p=!0,ot(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){const d=In(e.target);c.fragment&&c.fragment.l(d),d.forEach($)}else c.fragment&&c.fragment.c();e.intro&&It(t.$$.fragment),ee(t,e.target,e.anchor,e.customElement),Pe()}bt(l)}class re{$destroy(){ne(this,1),this.$destroy=Mt}$on(e,n){if(!I(n))return Mt;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!xn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var q=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(q||{});const ie=(t,e)=>e,Un=t=>{let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach(([s,i])=>{e=Math.min(e,s),n=Math.min(n,i),o=Math.max(o,s),r=Math.max(r,i)}),{minX:e,minY:n,maxX:o,maxY:r}},Dn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:s,ry:i}=t.geometry,a=0,l=Math.cos(a),c=Math.sin(a),p=e-o,d=n-r,m=l*p+c*d,u=c*p-l*d;return m*m/(s*s)+u*u/(i*i)<=1}};ie(q.ELLIPSE,Dn);const zn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let s=0,i=o.length-1;s<o.length;i=s++){const a=o[s][0],l=o[s][1],c=o[i][0],p=o[i][1];l>n!=p>n&&e<(c-a)*(n-l)/(p-l)+a&&(r=!r)}return r}};ie(q.POLYGON,zn);const Cn={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};ie(q.RECTANGLE,Cn);const Bn=[];for(let t=0;t<256;++t)Bn.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const jn=[];for(let t=0;t<256;++t)jn.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),""))();function Ie(t,e,n){const o=t.slice();return o[11]=e[n],o[13]=n,o}function ve(t){let e,n,o,r,s;return{c(){e=k("rect"),f(e,"class","a9s-corner-handle"),f(e,"x",n=t[11][0]-t[3]/2),f(e,"y",o=t[11][1]-t[3]/2),f(e,"height",t[3]),f(e,"width",t[3])},m(i,a){O(i,e,a),r||(s=v(e,"pointerdown",function(){I(t[10](_(t[13])))&&t[10](_(t[13])).apply(this,arguments)}),r=!0)},p(i,a){t=i,a&24&&n!==(n=t[11][0]-t[3]/2)&&f(e,"x",n),a&24&&o!==(o=t[11][1]-t[3]/2)&&f(e,"y",o),a&8&&f(e,"height",t[3]),a&8&&f(e,"width",t[3])},d(i){i&&$(e),r=!1,s()}}}function Vn(t){let e,n,o,r,s,i,a,l,c,p,d=t[4].points,m=[];for(let u=0;u<d.length;u+=1)m[u]=ve(Ie(t,d,u));return{c(){e=k("polygon"),r=W(),s=k("polygon"),a=W();for(let u=0;u<m.length;u+=1)m[u].c();l=Ln(),f(e,"class","a9s-outer"),f(e,"style",n=t[1]?"display:none;":void 0),f(e,"points",o=t[4].points.map(Ae).join(" ")),f(s,"class","a9s-inner a9s-shape-handle"),f(s,"style",t[1]),f(s,"points",i=t[4].points.map(ke).join(" "))},m(u,y){O(u,e,y),O(u,r,y),O(u,s,y),O(u,a,y);for(let h=0;h<m.length;h+=1)m[h]&&m[h].m(u,y);O(u,l,y),c||(p=[v(e,"pointerdown",function(){I(t[10](_.SHAPE))&&t[10](_.SHAPE).apply(this,arguments)}),v(s,"pointerdown",function(){I(t[10](_.SHAPE))&&t[10](_.SHAPE).apply(this,arguments)})],c=!0)},p(u,y){if(t=u,y&2&&n!==(n=t[1]?"display:none;":void 0)&&f(e,"style",n),y&16&&o!==(o=t[4].points.map(Ae).join(" "))&&f(e,"points",o),y&2&&f(s,"style",t[1]),y&16&&i!==(i=t[4].points.map(ke).join(" "))&&f(s,"points",i),y&1048){d=t[4].points;let h;for(h=0;h<d.length;h+=1){const T=Ie(t,d,h);m[h]?m[h].p(T,y):(m[h]=ve(T),m[h].c(),m[h].m(l.parentNode,l))}for(;h<m.length;h+=1)m[h].d(1);m.length=d.length}},d(u){u&&$(e),u&&$(r),u&&$(s),u&&$(a),Pn(m,u),u&&$(l),c=!1,ot(p)}}}function Wn(t){let e,n;return e=new Ne({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[Vn,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:t}}}),e.$on("change",t[7]),e.$on("grab",t[8]),e.$on("release",t[9]),{c(){Le(e.$$.fragment)},m(o,r){ee(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&17434&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(It(e.$$.fragment,o),n=!0)},o(o){te(e.$$.fragment,o),n=!1},d(o){ne(e,o)}}}const Ae=t=>t.join(","),ke=t=>t.join(",");function qn(t,e,n){let o,r,{shape:s}=e,{computedStyle:i=void 0}=e,{transform:a}=e,{viewportScale:l=1}=e;const c=(u,y,h)=>{let T;y===_.SHAPE?T=u.geometry.points.map(([w,x])=>[w+h[0],x+h[1]]):T=u.geometry.points.map(([w,x],H)=>y===_(H)?[w+h[0],x+h[1]]:[w,x]);const E=Un(T);return{...u,geometry:{points:T,bounds:E}}};function p(u){at.call(this,t,u)}function d(u){at.call(this,t,u)}function m(u){at.call(this,t,u)}return t.$$set=u=>{"shape"in u&&n(0,s=u.shape),"computedStyle"in u&&n(1,i=u.computedStyle),"transform"in u&&n(2,a=u.transform),"viewportScale"in u&&n(6,l=u.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=s.geometry),t.$$.dirty&64&&n(3,r=10/l)},[s,i,a,r,o,c,l,p,d,m]}class Yn extends re{constructor(e){super(),oe(this,e,qn,Wn,Qt,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}function Mn(t){let e,n,o,r,s,i,a,l,c,p,d,m,u,y,h,T,E,w,x,H,B,A,G,P,Q,rt,vt,se,j,At,kt,Ht,le,R,Nt,Gt,ae,X,Rt,Xt,ce,F,Ft,Ut,fe,U,Dt,zt,ue,Be;return{c(){e=k("rect"),a=W(),l=k("rect"),u=W(),y=k("rect"),w=W(),x=k("rect"),G=W(),P=k("rect"),se=W(),j=k("rect"),le=W(),R=k("rect"),ae=W(),X=k("rect"),ce=W(),F=k("rect"),fe=W(),U=k("rect"),f(e,"class","a9s-outer"),f(e,"style",n=t[1]?"display:none;":void 0),f(e,"x",o=t[4].x),f(e,"y",r=t[4].y),f(e,"width",s=t[4].w),f(e,"height",i=t[4].h),f(l,"class","a9s-inner a9s-shape-handle"),f(l,"style",t[1]),f(l,"x",c=t[4].x),f(l,"y",p=t[4].y),f(l,"width",d=t[4].w),f(l,"height",m=t[4].h),f(y,"class","a9s-edge-handle a9s-edge-handle-top"),f(y,"x",h=t[4].x),f(y,"y",T=t[4].y),f(y,"height",1),f(y,"width",E=t[4].w),f(x,"class","a9s-edge-handle a9s-edge-handle-right"),f(x,"x",H=t[4].x+t[4].w),f(x,"y",B=t[4].y),f(x,"height",A=t[4].h),f(x,"width",1),f(P,"class","a9s-edge-handle a9s-edge-handle-bottom"),f(P,"x",Q=t[4].x),f(P,"y",rt=t[4].y+t[4].h),f(P,"height",1),f(P,"width",vt=t[4].w),f(j,"class","a9s-edge-handle a9s-edge-handle-left"),f(j,"x",At=t[4].x),f(j,"y",kt=t[4].y),f(j,"height",Ht=t[4].h),f(j,"width",1),f(R,"class","a9s-corner-handle a9s-corner-handle-topleft"),f(R,"x",Nt=t[4].x-t[3]/2),f(R,"y",Gt=t[4].y-t[3]/2),f(R,"height",t[3]),f(R,"width",t[3]),f(X,"class","a9s-corner-handle a9s-corner-handle-topright"),f(X,"x",Rt=t[4].x+t[4].w-t[3]/2),f(X,"y",Xt=t[4].y-t[3]/2),f(X,"height",t[3]),f(X,"width",t[3]),f(F,"class","a9s-corner-handle a9s-corner-handle-bottomright"),f(F,"x",Ft=t[4].x+t[4].w-t[3]/2),f(F,"y",Ut=t[4].y+t[4].h-t[3]/2),f(F,"height",t[3]),f(F,"width",t[3]),f(U,"class","a9s-corner-handle a9s-corner-handle-bottomleft"),f(U,"x",Dt=t[4].x-t[3]/2),f(U,"y",zt=t[4].y+t[4].h-t[3]/2),f(U,"height",t[3]),f(U,"width",t[3])},m(b,g){O(b,e,g),O(b,a,g),O(b,l,g),O(b,u,g),O(b,y,g),O(b,w,g),O(b,x,g),O(b,G,g),O(b,P,g),O(b,se,g),O(b,j,g),O(b,le,g),O(b,R,g),O(b,ae,g),O(b,X,g),O(b,ce,g),O(b,F,g),O(b,fe,g),O(b,U,g),ue||(Be=[v(e,"pointerdown",function(){I(t[10](_.SHAPE))&&t[10](_.SHAPE).apply(this,arguments)}),v(l,"pointerdown",function(){I(t[10](_.SHAPE))&&t[10](_.SHAPE).apply(this,arguments)}),v(y,"pointerdown",function(){I(t[10](_.TOP))&&t[10](_.TOP).apply(this,arguments)}),v(x,"pointerdown",function(){I(t[10](_.RIGHT))&&t[10](_.RIGHT).apply(this,arguments)}),v(P,"pointerdown",function(){I(t[10](_.BOTTOM))&&t[10](_.BOTTOM).apply(this,arguments)}),v(j,"pointerdown",function(){I(t[10](_.LEFT))&&t[10](_.LEFT).apply(this,arguments)}),v(R,"pointerdown",function(){I(t[10](_.TOP_LEFT))&&t[10](_.TOP_LEFT).apply(this,arguments)}),v(X,"pointerdown",function(){I(t[10](_.TOP_RIGHT))&&t[10](_.TOP_RIGHT).apply(this,arguments)}),v(F,"pointerdown",function(){I(t[10](_.BOTTOM_RIGHT))&&t[10](_.BOTTOM_RIGHT).apply(this,arguments)}),v(U,"pointerdown",function(){I(t[10](_.BOTTOM_LEFT))&&t[10](_.BOTTOM_LEFT).apply(this,arguments)})],ue=!0)},p(b,g){t=b,g&2&&n!==(n=t[1]?"display:none;":void 0)&&f(e,"style",n),g&16&&o!==(o=t[4].x)&&f(e,"x",o),g&16&&r!==(r=t[4].y)&&f(e,"y",r),g&16&&s!==(s=t[4].w)&&f(e,"width",s),g&16&&i!==(i=t[4].h)&&f(e,"height",i),g&2&&f(l,"style",t[1]),g&16&&c!==(c=t[4].x)&&f(l,"x",c),g&16&&p!==(p=t[4].y)&&f(l,"y",p),g&16&&d!==(d=t[4].w)&&f(l,"width",d),g&16&&m!==(m=t[4].h)&&f(l,"height",m),g&16&&h!==(h=t[4].x)&&f(y,"x",h),g&16&&T!==(T=t[4].y)&&f(y,"y",T),g&16&&E!==(E=t[4].w)&&f(y,"width",E),g&16&&H!==(H=t[4].x+t[4].w)&&f(x,"x",H),g&16&&B!==(B=t[4].y)&&f(x,"y",B),g&16&&A!==(A=t[4].h)&&f(x,"height",A),g&16&&Q!==(Q=t[4].x)&&f(P,"x",Q),g&16&&rt!==(rt=t[4].y+t[4].h)&&f(P,"y",rt),g&16&&vt!==(vt=t[4].w)&&f(P,"width",vt),g&16&&At!==(At=t[4].x)&&f(j,"x",At),g&16&&kt!==(kt=t[4].y)&&f(j,"y",kt),g&16&&Ht!==(Ht=t[4].h)&&f(j,"height",Ht),g&24&&Nt!==(Nt=t[4].x-t[3]/2)&&f(R,"x",Nt),g&24&&Gt!==(Gt=t[4].y-t[3]/2)&&f(R,"y",Gt),g&8&&f(R,"height",t[3]),g&8&&f(R,"width",t[3]),g&24&&Rt!==(Rt=t[4].x+t[4].w-t[3]/2)&&f(X,"x",Rt),g&24&&Xt!==(Xt=t[4].y-t[3]/2)&&f(X,"y",Xt),g&8&&f(X,"height",t[3]),g&8&&f(X,"width",t[3]),g&24&&Ft!==(Ft=t[4].x+t[4].w-t[3]/2)&&f(F,"x",Ft),g&24&&Ut!==(Ut=t[4].y+t[4].h-t[3]/2)&&f(F,"y",Ut),g&8&&f(F,"height",t[3]),g&8&&f(F,"width",t[3]),g&24&&Dt!==(Dt=t[4].x-t[3]/2)&&f(U,"x",Dt),g&24&&zt!==(zt=t[4].y+t[4].h-t[3]/2)&&f(U,"y",zt),g&8&&f(U,"height",t[3]),g&8&&f(U,"width",t[3])},d(b){b&&$(e),b&&$(a),b&&$(l),b&&$(u),b&&$(y),b&&$(w),b&&$(x),b&&$(G),b&&$(P),b&&$(se),b&&$(j),b&&$(le),b&&$(R),b&&$(ae),b&&$(X),b&&$(ce),b&&$(F),b&&$(fe),b&&$(U),ue=!1,ot(Be)}}}function Qn(t){let e,n;return e=new Ne({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[Mn,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:t}}}),e.$on("grab",t[7]),e.$on("change",t[8]),e.$on("release",t[9]),{c(){Le(e.$$.fragment)},m(o,r){ee(e,o,r),n=!0},p(o,[r]){const s={};r&1&&(s.shape=o[0]),r&4&&(s.transform=o[2]),r&3098&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){n||(It(e.$$.fragment,o),n=!0)},o(o){te(e.$$.fragment,o),n=!1},d(o){ne(e,o)}}}function Zn(t,e,n){let o,r,{shape:s}=e,{computedStyle:i=void 0}=e,{transform:a}=e,{viewportScale:l=1}=e;const c=(u,y,h)=>{const T=u.geometry.bounds;let[E,w]=[T.minX,T.minY],[x,H]=[T.maxX,T.maxY];const[B,A]=h;if(y===_.SHAPE)E+=B,x+=B,w+=A,H+=A;else{switch(y){case _.TOP:case _.TOP_LEFT:case _.TOP_RIGHT:{w+=A;break}case _.BOTTOM:case _.BOTTOM_LEFT:case _.BOTTOM_RIGHT:{H+=A;break}}switch(y){case _.LEFT:case _.TOP_LEFT:case _.BOTTOM_LEFT:{E+=B;break}case _.RIGHT:case _.TOP_RIGHT:case _.BOTTOM_RIGHT:{x+=B;break}}}const G=Math.min(E,x),P=Math.min(w,H),Q=Math.abs(x-E),rt=Math.abs(H-w);return{...u,geometry:{x:G,y:P,w:Q,h:rt,bounds:{minX:G,minY:P,maxX:G+Q,maxY:P+rt}}}};function p(u){at.call(this,t,u)}function d(u){at.call(this,t,u)}function m(u){at.call(this,t,u)}return t.$$set=u=>{"shape"in u&&n(0,s=u.shape),"computedStyle"in u&&n(1,i=u.computedStyle),"transform"in u&&n(2,a=u.transform),"viewportScale"in u&&n(6,l=u.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=s.geometry),t.$$.dirty&64&&n(3,r=10/l)},[s,i,a,r,o,c,l,p,d,m]}class Jn extends re{constructor(e){super(),oe(this,e,Zn,Qn,Qt,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}q.RECTANGLE,q.POLYGON;const _=t=>`HANDLE-${t}`;_.SHAPE="SHAPE",_.TOP="TOP",_.RIGHT="RIGHT",_.BOTTOM="BOTTOM",_.LEFT="LEFT",_.TOP_LEFT="TOP_LEFT",_.TOP_RIGHT="TOP_RIGHT",_.BOTTOM_RIGHT="BOTTOM_RIGHT",_.BOTTOM_LEFT="BOTTOM_LEFT";const Kn=t=>({}),He=t=>({grab:t[0]});function to(t){let e,n,o,r;const s=t[7].default,i=En(s,t,t[6],He);return{c(){e=k("g"),i&&i.c(),f(e,"class","a9s-annotation selected")},m(a,l){O(a,e,l),i&&i.m(e,null),n=!0,o||(r=[v(e,"pointerup",t[2]),v(e,"pointermove",t[1])],o=!0)},p(a,[l]){i&&i.p&&(!n||l&64)&&On(i,s,a,a[6],n?$n(s,a[6],l,Kn):Sn(a[6]),He)},i(a){n||(It(i,a),n=!0)},o(a){te(i,a),n=!1},d(a){a&&$(e),i&&i.d(a),o=!1,ot(r)}}}function eo(t,e,n){let{$$slots:o={},$$scope:r}=e;const s=kn();let{shape:i}=e,{editor:a}=e,{transform:l}=e,c=null,p,d=null;const m=h=>T=>{c=h,p=l.elementToImage(T.offsetX,T.offsetY),d=i,T.target.setPointerCapture(T.pointerId),s("grab")},u=h=>{if(c){const[T,E]=l.elementToImage(h.offsetX,h.offsetY),w=[T-p[0],E-p[1]];n(3,i=a(d,c,w)),s("change",i)}},y=h=>{h.target.releasePointerCapture(h.pointerId),c=null,d=i,s("release")};return t.$$set=h=>{"shape"in h&&n(3,i=h.shape),"editor"in h&&n(4,a=h.editor),"transform"in h&&n(5,l=h.transform),"$$scope"in h&&n(6,r=h.$$scope)},[m,u,y,i,a,l,r,o]}class Ne extends re{constructor(e){super(),oe(this,e,eo,to,Qt,{shape:3,editor:4,transform:5})}}navigator.userAgent.indexOf("Mac OS X");const Ge=t=>new Promise(e=>{var n;if((n=t.world.getItemAt(0))!=null&&n.source){const{x:o,y:r}=t.world.getItemAt(0).source.dimensions;e({width:o,height:r})}else{const o=()=>{const{x:r,y:s}=t.world.getItemAt(0).source.dimensions;t.removeHandler("open",o),e({width:r,height:s})};t.addHandler("open",o)}}),no=(t,e,n)=>{const{bounds:o}=t.geometry,r=o.minX*e,s=o.minY*n,i=o.maxX*e,a=o.maxY*n;return t.type===q.RECTANGLE?{type:q.RECTANGLE,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:a},x:r,y:s,w:i-r,h:a-s}}:t.type===q.POLYGON?{type:q.POLYGON,geometry:{bounds:{minX:r,minY:s,maxX:i,maxY:a},points:t.geometry.points.map(([l,c])=>[l*e,c*n])}}:(console.error("Unsupported shape type",t),t)},oo=(t,e,n)=>{const o=e.width,r=e.height,s=n.width,i=n.height;if(o&&r){const a=s/o,l=i/r;return a===1&&l==1?t:(console.log("[TextLayerExtension] Page and image are different size - scaling annotations"),t.map(c=>({...c,target:{...c.target,selector:no(c.target.selector,a,l)}})))}else return console.warn("[TextLayerExtension] Cannot scale annotations without page dimensions"),t};function Re(t,e,n){const o=t.slice();return o[12]=e[n],o}function Xe(t,e,n){const o=t.slice();return o[12]=e[n],o}function Fe(t,e,n){const o=t.slice();return o[12]=e[n],o}function Ue(t){let e,n,o,r,s;const i=[so,io,ro],a=[];function l(c,p){return c[0].mode==="fixedScreenSize"||!c[0].mode?0:c[0].mode==="fixedPageSize"?1:c[0].mode==="fillBounds"?2:-1}return~(n=l(t))&&(o=a[n]=i[n](t)),{c(){e=K("div"),o&&o.c(),z(e,"style",r=`transform:${t[3]}; width: ${t[6]}px; height: ${t[7]}px`),z(e,"class","a9s-annotationlayer a9s-osd-textlayer"),C(e,"fixed-screen-size",t[0].mode==="fixedScreenSize"||!t[0].mode),C(e,"fixed-page-size",t[0].mode==="fixedPageSize"),C(e,"fill-bounds",t[0].mode==="fillBounds"),C(e,"bottomleft",t[0].position!=="topleft"),C(e,"topleft",t[0].position==="topleft"),C(e,"pointer-events",t[2])},m(c,p){V(c,e,p),~n&&a[n].m(e,null),s=!0},p(c,p){let d=n;n=l(c),n===d?~n&&a[n].p(c,p):(o&&(gt(),N(a[d],1,1,()=>{a[d]=null}),yt()),~n?(o=a[n],o?o.p(c,p):(o=a[n]=i[n](c),o.c()),S(o,1),o.m(e,null)):o=null),(!s||p&200&&r!==(r=`transform:${c[3]}; width: ${c[6]}px; height: ${c[7]}px`))&&z(e,"style",r),(!s||p&1)&&C(e,"fixed-screen-size",c[0].mode==="fixedScreenSize"||!c[0].mode),(!s||p&1)&&C(e,"fixed-page-size",c[0].mode==="fixedPageSize"),(!s||p&1)&&C(e,"fill-bounds",c[0].mode==="fillBounds"),(!s||p&1)&&C(e,"bottomleft",c[0].position!=="topleft"),(!s||p&1)&&C(e,"topleft",c[0].position==="topleft"),(!s||p&4)&&C(e,"pointer-events",c[2])},i(c){s||(S(o),s=!0)},o(c){N(o),s=!1},d(c){c&&D(e),~n&&a[n].d()}}}function ro(t){let e,n,o=t[5],r=[];for(let i=0;i<o.length;i+=1)r[i]=De(Re(t,o,i));const s=i=>N(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=et()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);V(i,e,a),n=!0},p(i,a){if(a&33){o=i[5];let l;for(l=0;l<o.length;l+=1){const c=Re(i,o,l);r[l]?(r[l].p(c,a),S(r[l],1)):(r[l]=De(c),r[l].c(),S(r[l],1),r[l].m(e.parentNode,e))}for(gt(),l=o.length;l<r.length;l+=1)s(l);yt()}},i(i){if(!n){for(let a=0;a<o.length;a+=1)S(r[a]);n=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);n=!1},d(i){Bt(r,i),i&&D(e)}}}function io(t){let e,n,o=t[5],r=[];for(let i=0;i<o.length;i+=1)r[i]=ze(Xe(t,o,i));const s=i=>N(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=et()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);V(i,e,a),n=!0},p(i,a){if(a&33){o=i[5];let l;for(l=0;l<o.length;l+=1){const c=Xe(i,o,l);r[l]?(r[l].p(c,a),S(r[l],1)):(r[l]=ze(c),r[l].c(),S(r[l],1),r[l].m(e.parentNode,e))}for(gt(),l=o.length;l<r.length;l+=1)s(l);yt()}},i(i){if(!n){for(let a=0;a<o.length;a+=1)S(r[a]);n=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);n=!1},d(i){Bt(r,i),i&&D(e)}}}function so(t){let e,n,o=t[5],r=[];for(let i=0;i<o.length;i+=1)r[i]=Ce(Fe(t,o,i));const s=i=>N(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=et()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);V(i,e,a),n=!0},p(i,a){if(a&241){o=i[5];let l;for(l=0;l<o.length;l+=1){const c=Fe(i,o,l);r[l]?(r[l].p(c,a),S(r[l],1)):(r[l]=Ce(c),r[l].c(),S(r[l],1),r[l].m(e.parentNode,e))}for(gt(),l=o.length;l<r.length;l+=1)s(l);yt()}},i(i){if(!n){for(let a=0;a<o.length;a+=1)S(r[a]);n=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)N(r[a]);n=!1},d(i){Bt(r,i),i&&D(e)}}}function De(t){let e,n;return e=new pn({props:{annotation:t[12],opts:t[0]}}),{c(){Yt(e.$$.fragment)},m(o,r){$t(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[12]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){N(e.$$.fragment,o),n=!1},d(o){Ot(e,o)}}}function ze(t){let e,n;return e=new yn({props:{annotation:t[12],opts:t[0]}}),{c(){Yt(e.$$.fragment)},m(o,r){$t(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[12]),r&1&&(s.opts=o[0]),e.$set(s)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){N(e.$$.fragment,o),n=!1},d(o){Ot(e,o)}}}function Ce(t){let e,n;return e=new wn({props:{annotation:t[12],opts:t[0],imageSize:[t[6],t[7]],scale:t[4]}}),{c(){Yt(e.$$.fragment)},m(o,r){$t(e,o,r),n=!0},p(o,r){const s={};r&32&&(s.annotation=o[12]),r&1&&(s.opts=o[0]),r&192&&(s.imageSize=[o[6],o[7]]),r&16&&(s.scale=o[4]),e.$set(s)},i(o){n||(S(e.$$.fragment,o),n=!0)},o(o){N(e.$$.fragment,o),n=!1},d(o){Ot(e,o)}}}function lo(t){let e,n,o=t[1]&&Ue(t);return{c(){o&&o.c(),e=et()},m(r,s){o&&o.m(r,s),V(r,e,s),n=!0},p(r,[s]){r[1]?o?(o.p(r,s),s&2&&S(o,1)):(o=Ue(r),o.c(),S(o,1),o.m(e.parentNode,e)):o&&(gt(),N(o,1,1,()=>{o=null}),yt())},i(r){n||(S(o),n=!0)},o(r){N(o),n=!1},d(r){o&&o.d(r),r&&D(e)}}}function ao(t,e,n){let{state:o}=e,{viewer:r}=e,{opts:s}=e,{visible:i=!0}=e,{captureEvents:a=!1}=e;const{store:l}=o;let c,p,d=[],m,u;const y=()=>{const h=r.viewport.viewportToImageRectangle(r.viewport.getBounds(!0)),T=r.viewport.getContainerSize().x,E=r.viewport.getZoom(!0);n(4,p=E*T/r.world.getContentFactor());let w=Math.PI*r.viewport.getRotation(!0)/180;w<0&&(w+=2*Math.PI),w>2*Math.PI&&(w-=2*Math.PI);const x=r.viewport.getFlip(),H=x?r.viewport._containerInnerSize.x+h.x*p:-h.x*p,B=-h.y*p;let A,G;w>0&&w<=Math.PI/2?(A=h.height*p,G=0):w>Math.PI/2&&w<=Math.PI?(A=h.width*p,G=h.height*p):w>Math.PI&&w<=Math.PI*1.5?(A=0,G=h.width*p):(A=0,G=0);const P=Math.round(100*(A+H*Math.cos(w)-B*Math.sin(w)))/100,Q=Math.round(100*(G+H*Math.sin(w)+B*Math.cos(w)))/100;n(3,c=`translate(${P}px, ${Q}px) rotate(${w}rad) scaleX(${x?-p:p}) scaleY(${p})`)};return sn(()=>{Ge(r).then(E=>{n(6,m=E.width),n(7,u=E.height)}),r.addHandler("update-viewport",y);const h=E=>{n(5,d=E.state),y()};l.observe(h);const T=E=>{const w=document.getSelection().toString(),x=E.clipboardData||window.clipboardData;x.setData("text/plain",w),x.setData("text/html",w),E.preventDefault()};return document.addEventListener("copy",T),()=>{r.removeHandler("update-viewport",y),l.unobserve(h),document.removeEventListener("copy",T)}}),t.$$set=h=>{"state"in h&&n(8,o=h.state),"viewer"in h&&n(9,r=h.viewer),"opts"in h&&n(0,s=h.opts),"visible"in h&&n(1,i=h.visible),"captureEvents"in h&&n(2,a=h.captureEvents)},[s,i,a,c,p,d,m,u,o,r]}class co extends Pt{constructor(e){super(),St(this,e,ao,lo,Tt,{state:8,viewer:9,opts:0,visible:1,captureEvents:2})}}const po="",fo=(t,e)=>{const{viewer:n,state:o}=t;let r=e.defaultVisible===void 0?!0:e.defaultVisible,s=!1;const i=new co({target:n.element.querySelector(".openseadragon-canvas"),props:{state:o,viewer:n,opts:e,visible:r}});return{isLocked:()=>s,isVisible:()=>r,loadOCR:(u,y="ALTO")=>fetch(u).then(h=>h.text()).then(h=>{const{annotations:T,metadata:E}=en(h);Ge(n).then(w=>{const x=oo(T,E,w);t.setAnnotations(x)})}),setLocked:u=>{s=u,n.setMouseNavEnabled(!u),i.$$set({captureEvents:u})},setVisible:u=>{r=u,i.$$set({visible:u})},unmount:()=>i.$destroy()}};Z.mountExtension=fo,Z.transcriptionLabel=ht,Object.defineProperty(Z,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-openseadragon-textlayer.js.map
